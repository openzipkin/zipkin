#
# Copyright 2015-2023 The OpenZipkin Authors
#
# Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except
# in compliance with the License. You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software distributed under the License
# is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
# or implied. See the License for the specific language governing permissions and limitations under
# the License.
#

core:
  selector: zipkin
  zipkin:
    # The max length of service + instance names should be less than 200
    serviceNameMaxLength: ${ZIPKIN_SERVICE_NAME_MAX_LENGTH:70}
    # The period(in seconds) of refreshing the service cache. Default value is 10s.
    serviceCacheRefreshInterval: ${ZIPKIN_SERVICE_CACHE_REFRESH_INTERVAL:10}
    instanceNameMaxLength: ${ZIPKIN_INSTANCE_NAME_MAX_LENGTH:70}
    # The max length of service + endpoint names should be less than 240
    endpointNameMaxLength: ${ZIPKIN_ENDPOINT_NAME_MAX_LENGTH:150}
    recordDataTTL: ${ZIPKIN_CORE_RECORD_DATA_TTL:3} # Unit is day
    metricsDataTTL: ${ZIPKIN_CORE_METRICS_DATA_TTL:7} # Unit is day
    # The period of L1 aggregation flush to L2 aggregation. Unit is ms.
    l1FlushPeriod: ${ZIPKIN_CORE_L1_AGGREGATION_FLUSH_PERIOD:500}
    # The threshold of session time. Unit is ms. Default value is 70s.
    storageSessionTimeout: ${ZIPKIN_CORE_STORAGE_SESSION_TIMEOUT:70000}
    # The number of threads used to prepare metrics data to the storage.
    prepareThreads: ${ZIPKIN_PREPARE_THREADS:2}
    # The period of doing data persistence. Unit is second.Default value is 25s
    persistentPeriod: ${ZIPKIN_PERSISTENT_PERIOD:1}
    serverHost: ${ZIPKIN_SERVER_HOST:0.0.0.0}
    serverPort: ${ZIPKIN_SERVER_PORT:9411}
    serverMaxThreads: ${ZIPKIN_SERVER_MAX_THREADS:200}
    serverIdleTimeOut: ${ZIPKIN_SERVER_IDLE_TIMEOUT:30000}
    serverAcceptQueueSize: ${ZIPKIN_SERVER_QUEUE_SIZE:0}
    serverMaxRequestHeaderSize: ${ZIPKIN_SERVER_MAX_REQUEST_HEADER_SIZE:8192}
    serverThreadPoolQueueSize: ${ZIPKIN_SERVER_POOL_QUEUE_SIZE:-1}
    serverEnableTLS: ${ZIPKIN_SERVER_SSL_ENABLED:false}
    serverTLSKeyPath: ${ZIPKIN_SERVER_SSL_KEY_PATH:""}
    serverTLSCertChainPath: ${ZIPKIN_SERVER_SSL_CERT_CHAIN_PATH:""}
    clusterSslTrustedCAPath: ${ZIPKIN_SERVER_SSL_TRUSTED_CA_PATH:""}
    searchEnable: ${ZIPKIN_SEARCH_ENABLED:true}

storage:
  selector: ${ZIPKIN_STORAGE:cassandra}
  cassandra:
    keyspace: ${ZIPKIN_STORAGE_CASSANDRA_KEYSPACE:zipkin}
    # Comma separated list of host addresses part of Cassandra cluster. Ports default to 9042 but you can also specify a custom port with 'host:port'.
    contactPoints: ${ZIPKIN_STORAGE_CASSANDRA_CONTACT_POINTS:localhost}
    # Name of the datacenter that will be considered "local" for load balancing.
    localDc: ${ZIPKIN_STORAGE_CASSANDRA_LOCAL_DC:datacenter1}
    # Will throw an exception on startup if authentication fails.
    username: ${ZIPKIN_STORAGE_CASSANDRA_USERNAME:}
    password: ${ZIPKIN_STORAGE_CASSANDRA_PASSWORD:}
    # Max pooled connections per datacenter-local host.
    maxConnections: ${ZIPKIN_STORAGE_CASSANDRA_MAX_CONNECTIONS:8}
    # Using ssl for connection, rely on Keystore
    use-ssl: ${ZIPKIN_STORAGE_CASSANDRA_USE_SSL:false}
    maxSizeOfBatchCql: ${ZIPKIN_STORAGE_CASSANDRA_MAX_SIZE_OF_BATCH_CQL:2000}
    asyncBatchPersistentPoolSize: ${ZIPKIN_STORAGE_CASSANDRA_ASYNC_BATCH_PERSISTENT_POOL_SIZE:4}

receiver-zipkin:
  selector: zipkin
  zipkin:
    # Defines a set of span tag keys which are searchable.
    # The max length of key=value should be less than 256 or will be dropped.
    searchableTracesTags: ${ZIPKIN_SEARCHABLE_TAG_KEYS:http.path}
    # The trace sample rate precision is 0.0001, should be between 0 and 1
    traceSampleRate: ${ZIPKIN_SAMPLE_RATE:1}

telemetry:
  selector: ${ZIPKIN_TELEMETRY:none}
  none:

cluster:
  selector: standalone
  standalone: